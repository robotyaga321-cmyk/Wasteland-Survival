<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kingdom Craft & Survive</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --bg: #2d5a27; --panel: rgba(0,0,0,0.9); --border: #555; --accent: #f1c40f; }
        body { margin: 0; background: var(--bg); overflow: hidden; font-family: sans-serif; color: white; }
        canvas { display: block; touch-action: none; }

        /* –í–µ—Ä—Ö–Ω–∏–µ —Å—Ç–∞—Ç—ã */
        .ui-top { position: absolute; top: 65px; left: 15px; pointer-events: none; z-index: 5; }
        .stat-item { background: var(--panel); padding: 5px 10px; border-radius: 5px; margin-bottom: 5px; font-size: 14px; border: 1px solid var(--border); }

        /* –ö–Ω–æ–ø–∫–∞ –°—É–º–∫–∏ (–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å) */
        .inventory-trigger {
            position: absolute; bottom: 20px; right: 20px;
            width: 60px; height: 60px; background: #8b4513;
            border-radius: 50%; border: 3px solid #5d2e0a;
            display: flex; align-items: center; justify-content: center;
            font-size: 30px; z-index: 20; box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }

        /* –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å + –ö—Ä–∞—Ñ—Ç + –ú–∞–≥–∞–∑–∏–Ω) */
        #main-menu {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 100; display: none;
            flex-direction: column; align-items: center; justify-content: center;
        }

        .menu-container { background: #333; padding: 20px; border-radius: 15px; border: 4px solid #555; width: 90%; max-width: 400px; }
        .menu-header { display: flex; justify-content: space-between; margin-bottom: 15px; border-bottom: 2px solid #555; padding-bottom: 10px; }
        
        .grid-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        
        /* –°–µ—Ç–∫–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è */
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; }
        .slot { width: 45px; height: 45px; background: #555; border: 2px solid #888; border-radius: 5px; display: flex; align-items: center; justify-content: center; font-size: 20px; }

        /* –ö—Ä–∞—Ñ—Ç */
        .craft-zone { display: grid; grid-template-columns: repeat(2, 1fr); gap: 5px; position: relative; }
        .craft-result { margin-left: 10px; display: flex; align-items: center; font-size: 24px; }

        /* –î–æ–Ω–∞—Ç –∫–Ω–æ–ø–∫–∞ –≤–Ω—É—Ç—Ä–∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è */
        .donate-btn {
            margin-top: 15px; background: linear-gradient(to bottom, #f1c40f, #d35400);
            border: none; width: 100%; padding: 12px; border-radius: 8px;
            color: black; font-weight: bold; font-size: 14px;
        }

        .close-menu { background: #e74c3c; border: none; color: white; padding: 5px 15px; border-radius: 5px; }
    </style>
</head>
<body>

    <div class="ui-top">
        <div class="stat-item">üå≤ –î–µ—Ä–µ–≤–æ: <span id="res-wood">0</span></div>
        <div class="stat-item">üíé –ó–≤—ë–∑–¥—ã: <span id="res-stars">0</span></div>
    </div>

    <canvas id="game"></canvas>

    <div class="inventory-trigger" onclick="toggleMenu()">üéí</div>

    <div id="main-menu">
        <div class="menu-container">
            <div class="menu-header">
                <span>–ò–ù–í–ï–ù–¢–ê–†–¨ / –ö–†–ê–§–¢</span>
                <button class="close-menu" onclick="toggleMenu()">X</button>
            </div>

            <div class="grid-layout">
                <div>
                    <small>–ü—Ä–µ–¥–º–µ—Ç—ã:</small>
                    <div class="grid">
                        <div class="slot">üå≤</div><div class="slot"></div><div class="slot"></div>
                        <div class="slot"></div><div class="slot"></div><div class="slot"></div>
                        <div class="slot"></div><div class="slot"></div><div class="slot"></div>
                    </div>
                </div>

                <div>
                    <small>–ö—Ä–∞—Ñ—Ç (2x2):</small>
                    <div style="display: flex;">
                        <div class="craft-zone">
                            <div class="slot"></div><div class="slot"></div>
                            <div class="slot"></div><div class="slot"></div>
                        </div>
                        <div class="craft-result">‚û°Ô∏è ‚öíÔ∏è</div>
                    </div>
                </div>
            </div>

            <button class="donate-btn" onclick="buyStars()">üåü –ú–ê–ì–ê–ó–ò–ù –ó–í–Å–ó–î (–ö–£–ü–ò–¢–¨ –í–ï–©–ò)</button>
        </div>
    </div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    let isMenuOpen = false;

    // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–∏—Ä–∞ (100k x 100k)
    const WORLD_SIZE = 100000;
    let player = { x: WORLD_SIZE/2, y: WORLD_SIZE/2, targetX: WORLD_SIZE/2, targetY: WORLD_SIZE/2, speed: 0.1 };
    let wood = 0;

    function toggleMenu() {
        isMenuOpen = !isMenuOpen;
        document.getElementById('main-menu').style.display = isMenuOpen ? 'flex' : 'none';
        if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
    }

    function buyStars() {
        tg.sendData("open_star_shop");
        if(tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
    }

    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    function draw() {
        ctx.fillStyle = '#348a3a';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // –†–∏—Å—É–µ–º —Å–µ—Ç–∫—É
        ctx.strokeStyle = 'rgba(0,0,0,0.05)';
        let startX = (canvas.width/2) - (player.x % 100);
        let startY = (canvas.height/2) - (player.y % 100);
        
        for(let x = startX - 500; x < canvas.width + 500; x += 100) {
            ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, canvas.height); ctx.stroke();
        }
        for(let y = startY - 500; y < canvas.height + 500; y += 100) {
            ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(canvas.width, y); ctx.stroke();
        }

        // –†–∏—Å—É–µ–º "–ö–æ—Ä–æ–ª—è"
        ctx.fillStyle = '#f1c40f';
        ctx.fillRect(canvas.width/2 - 15, canvas.height/2 - 15, 30, 30);

        // –î–≤–∏–∂–µ–Ω–∏–µ
        player.x += (player.targetX - player.x) * player.speed;
        player.y += (player.targetY - player.y) * player.speed;

        requestAnimationFrame(draw);
    }

    window.addEventListener('pointerdown', (e) => {
        if(isMenuOpen || e.target.closest('.inventory-trigger')) return;
        // –†–∞—Å—á–µ—Ç –º–∏—Ä–æ–≤—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —Ü–µ–ª–∏
        player.targetX = player.x + (e.clientX - canvas.width/2);
        player.targetY = player.y + (e.clientY - canvas.height/2);
    });

    draw();
</script>
</body>
</html>
