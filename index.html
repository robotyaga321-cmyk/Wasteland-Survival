<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CyberState Enterprise Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <style>
        :root {
            --accent: #00f2ff;
            --gold: #ffcc00;
        }
        body { margin: 0; background: #05050a; overflow: hidden; font-family: 'Inter', sans-serif; }
        
        /* –°–ª–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (UI) */
        #ui {
            position: absolute; width: 100%; height: 100%; 
            pointer-events: none; z-index: 100;
            display: flex; flex-direction: column; align-items: center;
        }

        .header {
            width: 90%; margin-top: 20px;
            display: flex; justify-content: space-between;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 15px; color: white; pointer-events: auto;
        }

        .balance-container { text-align: center; margin-top: 40px; }
        .balance-value { font-size: 48px; font-weight: 900; color: var(--accent); text-shadow: 0 0 20px rgba(0,242,255,0.5); }
        .pps { font-size: 14px; color: #888; letter-spacing: 2px; }

        .footer-nav {
            position: absolute; bottom: 30px; width: 90%;
            display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;
        }

        .nav-item {
            background: rgba(255,255,255,0.05); border: none; border-radius: 12px;
            color: white; padding: 12px; font-weight: bold; cursor: pointer;
            transition: 0.2s;
        }
        .nav-item:active { transform: scale(0.95); background: var(--accent); color: black; }
    </style>
</head>
<body>

    <div id="ui">
        <div class="header">
            <div class="glass-panel" id="user-display">@User</div>
            <div class="glass-panel" style="color: var(--gold)">üèÜ Top 1%</div>
        </div>

        <div class="balance-container">
            <div id="balance" class="balance-value">0</div>
            <div id="pps" class="pps">PROFITS: +0.0/s</div>
        </div>

        <div class="footer-nav">
            <button class="nav-item" onclick="upgrade('click')">‚ö°Ô∏è TAP</button>
            <button class="nav-item" onclick="upgrade('auto')">ü§ñ AUTO</button>
            <button class="nav-item" onclick="tg.openLink('https://t.me/your_channel')">üì¢ JOIN</button>
        </div>
    </div>

    <div id="game"></div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    // –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (State Management)
    let state = {
        balance: parseFloat(localStorage.getItem('bal')) || 0,
        clickPower: parseInt(localStorage.getItem('cp')) || 1,
        autoPower: parseFloat(localStorage.getItem('ap')) || 0,
        lastTick: Date.now()
    };

    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–≤–∏–∂–∫–∞
    const config = {
        type: Phaser.AUTO,
        parent: 'game',
        width: window.innerWidth,
        height: window.innerHeight,
        transparent: true,
        scene: { preload, create, update }
    };

    const game = new Phaser.Game(config);
    let coin, particles, emitter;

    function preload() {
        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∞—Å—Å–µ—Ç–æ–≤
        this.load.image('coin', 'https://cdn-icons-png.flaticon.com/512/5968/5968301.png'); // –ó–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π –ª–æ–≥–æ
        this.load.image('spark', 'https://labs.phaser.io/assets/particles/blue.png');
    }

    function create() {
        const { width, height } = this.scale;
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã —á–∞—Å—Ç–∏—Ü (Cyberpunk Style)
        particles = this.add.particles(0, 0, 'spark', {
            speed: { min: -200, max: 200 },
            angle: { min: 0, max: 360 },
            scale: { start: 0.4, end: 0 },
            blendMode: 'ADD',
            lifespan: 600,
            gravityY: 400,
            emitting: false
        });

        // –û—Å–Ω–æ–≤–Ω–æ–π –æ–±—ä–µ–∫—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
        coin = this.add.sprite(width / 2, height / 2 + 50, 'coin')
            .setInteractive()
            .setScale(0.5);

        // –ü–ª–∞–≤–Ω–æ–µ –≤—Ä–∞—â–µ–Ω–∏–µ –∏ –ª–µ–≤–∏—Ç–∞—Ü–∏—è
        this.tweens.add({
            targets: coin,
            y: height / 2 + 30,
            duration: 2000,
            yoyo: true,
            repeat: -1,
            ease: 'Sine.easeInOut'
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞
        coin.on('pointerdown', (pointer) => {
            handleTap(pointer.x, pointer.y);
            
            // –í–∏–∑—É–∞–ª—å–Ω—ã–π –æ—Ç–∫–ª–∏–∫
            this.tweens.add({
                targets: coin,
                scale: 0.45,
                duration: 50,
                yoyo: true
            });
            
            particles.emitParticleAt(pointer.x, pointer.y, 10);
            showClickText(this, pointer.x, pointer.y);
        });

        // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        document.getElementById('user-display').innerText = `@${tg.initDataUnsafe.user?.username || 'CyberMiner'}`;
    }

    function update(time, delta) {
        // –ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥ (—Ä–∞—Å—á–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏)
        if (state.autoPower > 0) {
            const now = Date.now();
            const diff = (now - state.lastTick) / 1000;
            state.balance += state.autoPower * diff;
            state.lastTick = now;
            updateUI();
        }
    }

    function handleTap(x, y) {
        state.balance += state.clickPower;
        updateUI();
        if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
    }

    function showClickText(scene, x, y) {
        const txt = scene.add.text(x, y - 40, `+${state.clickPower}`, {
            fontSize: '32px', fontStyle: 'bold', color: '#00f2ff'
        });
        scene.tweens.add({
            targets: txt, y: y - 120, alpha: 0, duration: 600,
            onComplete: () => txt.destroy()
        });
    }

    function updateUI() {
        document.getElementById('balance').innerText = Math.floor(state.balance).toLocaleString();
        document.getElementById('pps').innerText = `PROFITS: +${state.autoPower.toFixed(1)}/s`;
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (–≤ –∏–¥–µ–∞–ª–µ –¥–µ–ª–∞—Ç—å —á–µ—Ä–µ–∑ API –Ω–∞ —Å–µ—Ä–≤–µ—Ä)
        localStorage.setItem('bal', state.balance);
    }

    // –°–∏—Å—Ç–µ–º–∞ –∞–ø–≥—Ä–µ–π–¥–æ–≤
    window.upgrade = (type) => {
        if (type === 'click' && state.balance >= 50) {
            state.balance -= 50;
            state.clickPower += 1;
            tg.showAlert('Tap Power Upgraded!');
        } else if (type === 'auto' && state.balance >= 200) {
            state.balance -= 200;
            state.autoPower += 0.5;
            tg.showAlert('Mining Drone Active!');
        } else {
            tg.HapticFeedback.notificationOccurred('error');
        }
        updateUI();
    };
</script>
</body>
</html>
